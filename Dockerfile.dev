# ğŸ Imagen base ligera de Python
FROM python:3.11-slim

# ğŸ”§ Variables de entorno bÃ¡sicas
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV PIP_NO_CACHE_DIR=1

# ğŸ“ Crear directorio de trabajo
WORKDIR /app

# ğŸ§© Instalar dependencias del sistema necesarias para psycopg2 y compilaciÃ³n
RUN apt-get update && apt-get install -y \
    build-essential \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# ğŸ§° Copiar primero requirements.txt para aprovechar cachÃ© cuando no cambia
COPY requirements.txt /tmp/requirements.txt

# ğŸ Instalar dependencias de Python (siempre fuerza reinstall para evitar cachÃ©)
RUN pip install --upgrade pip && \
    pip install --force-reinstall -r /tmp/requirements.txt

# ğŸ§  Copiar todo el cÃ³digo del backend
COPY backend /app

# âš™ï¸ Exponer el puerto del servidor
EXPOSE 8000

# ğŸš€ Comando por defecto: iniciar servidor Django en modo desarrollo
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
